{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [],
   "source": [
    "from __future__ import print_function\n",
    "import torch\n",
    "import torch.nn as nn\n",
    "import torch.nn.functional as F\n",
    "import torch.optim as optim\n",
    "import torchvision\n",
    "from torchvision import datasets, transforms\n",
    "import matplotlib.pyplot as plt\n",
    "import numpy as np\n",
    "import torchvision.models as models\n",
    "import os, sys, json\n",
    "from models.track_net import TrackNet\n",
    "from utils.get_dataloader import get_dataloader\n",
    "import cv2\n",
    "from PIL import Image\n",
    "import datetime\n",
<<<<<<< HEAD:Untitled1.ipynb.bk
    "from models.unet import UNet\n",
=======
    "from models.unet_model import UNet\n",
>>>>>>> 96b4a10226fe47e8903cc6e716989b8a1a9100d4:Untitled1.ipynb
    "from utils.detector import detect\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "cuda0 = torch.device('cuda:0')\n",
    "#model = TrackNet().to(cuda0)\n",
<<<<<<< HEAD:Untitled1.ipynb.bk
    "model = UNet(9).to(cuda0)\n",
    "\n",
    "model.load_state_dict(torch.load('weight/epoch_12_4237'))\n",
=======
    "model = UNet(9, 1).to(cuda0)\n",
    "\n",
    "model.load_state_dict(torch.load('weight/epoch_34_4238'))\n",
>>>>>>> 96b4a10226fe47e8903cc6e716989b8a1a9100d4:Untitled1.ipynb
    "model.eval()\n",
    "\n",
    "\n",
    "def open_image(path, shape):\n",
    "    image = Image.open(path).convert(\"RGB\")\n",
    "    return np.asarray(image.resize(shape))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "ename": "FileNotFoundError",
     "evalue": "[Errno 2] No such file or directory: '../data/DJI_0014/img_10697.jpg'",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mFileNotFoundError\u001b[0m                         Traceback (most recent call last)",
      "\u001b[0;32m<ipython-input-8-adb3147d307d>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m \u001b[0mimage3\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mopen_image\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m'../data/DJI_0014/img_10697.jpg'\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m(\u001b[0m\u001b[0;36m640\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;36m360\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      2\u001b[0m \u001b[0mimage2\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mopen_image\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m'../data/DJI_0014/img_10696.jpg'\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m(\u001b[0m\u001b[0;36m640\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;36m360\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      3\u001b[0m \u001b[0mimage1\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mopen_image\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m'../data/DJI_0014/img_10695.jpg'\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m(\u001b[0m\u001b[0;36m640\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;36m360\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      4\u001b[0m \u001b[0mimage\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mnp\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdstack\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0mimage1\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mimage2\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mimage3\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      5\u001b[0m \u001b[0mprint\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mimage\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mshape\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m<ipython-input-4-084c2b754ee4>\u001b[0m in \u001b[0;36mopen_image\u001b[0;34m(path, shape)\u001b[0m\n\u001b[1;32m      9\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     10\u001b[0m \u001b[0;32mdef\u001b[0m \u001b[0mopen_image\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mpath\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mshape\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 11\u001b[0;31m     \u001b[0mimage\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mImage\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mopen\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mpath\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mconvert\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"RGB\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     12\u001b[0m     \u001b[0;32mreturn\u001b[0m \u001b[0mnp\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0masarray\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mimage\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mresize\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mshape\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;32m/usr/local/lib/python3.6/dist-packages/PIL/Image.py\u001b[0m in \u001b[0;36mopen\u001b[0;34m(fp, mode)\u001b[0m\n\u001b[1;32m   2632\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   2633\u001b[0m     \u001b[0;32mif\u001b[0m \u001b[0mfilename\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 2634\u001b[0;31m         \u001b[0mfp\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mbuiltins\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mopen\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mfilename\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m\"rb\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m   2635\u001b[0m         \u001b[0mexclusive_fp\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;32mTrue\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   2636\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;31mFileNotFoundError\u001b[0m: [Errno 2] No such file or directory: '../data/DJI_0014/img_10697.jpg'"
     ]
    }
   ],
   "source": [
    "image3 = open_image('../data/DJI_0014/img_10697.jpg', (640,360))\n",
    "image2 = open_image('../data/DJI_0014/img_10696.jpg', (640,360))\n",
    "image1 = open_image('../data/DJI_0014/img_10695.jpg', (640,360))\n",
    "image = np.dstack([image1, image2, image3])\n",
    "print(image.shape)\n",
    "image = image.transpose((2, 0, 1))\n",
    "image = image[np.newaxis, :]\n",
    "print(image.shape)\n",
    "image = torch.from_numpy(image).float().to(cuda0)\n",
    "print(image.shape)\n",
    "output = model(image) * 255"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "ename": "NameError",
     "evalue": "name 'output' is not defined",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mNameError\u001b[0m                                 Traceback (most recent call last)",
      "\u001b[0;32m<ipython-input-6-f88ed48186b0>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[1;32m      1\u001b[0m \u001b[0;32mimport\u001b[0m \u001b[0mmatplotlib\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mpyplot\u001b[0m \u001b[0;32mas\u001b[0m \u001b[0mplt\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 2\u001b[0;31m \u001b[0mprint\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0moutput\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mshape\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      3\u001b[0m \u001b[0moutput_numpy\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0moutput\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msqueeze\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcpu\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdetach\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mnumpy\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      4\u001b[0m \u001b[0mplt\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mimshow\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0moutput_numpy\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcmap\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34m\"gray\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      5\u001b[0m \u001b[0mplt\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mshow\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
      "\u001b[0;31mNameError\u001b[0m: name 'output' is not defined"
     ]
    }
   ],
   "source": [
    "import matplotlib.pyplot as plt\n",
    "print(output.shape)\n",
    "output_numpy = output.squeeze().cpu().detach().numpy()\n",
    "plt.imshow(output_numpy, cmap = \"gray\")\n",
    "plt.show()\n",
    "plt.imshow(image1)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
<<<<<<< HEAD:Untitled1.ipynb.bk
   "execution_count": 3,
   "execution_count": 5,
=======
   "execution_count": 13,
>>>>>>> 96b4a10226fe47e8903cc6e716989b8a1a9100d4:Untitled1.ipynb
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
<<<<<<< HEAD:Untitled1.ipynb.bk
      "100\n",
      "200\n",
      "300\n",
      "400\n",
      "500\n",
      "600\n",
      "700\n",
      "800\n",
      "900\n",
      "1000\n",
      "1100\n",
      "1200\n",
      "1300\n",
      "1400\n",
      "1500\n",
      "1600\n",
      "1700\n",
      "1800\n",
      "1900\n",
      "2000\n",
      "2100\n",
      "2200\n",
      "2300\n",
      "2400\n",
      "2500\n",
      "2600\n",
      "2700\n",
      "2800\n",
      "2900\n",
      "3000\n",
      "3100\n",
      "3200\n",
      "3300\n",
      "3400\n",
      "3500\n",
      "3600\n",
      "3700\n",
      "3800\n",
      "3900\n",
      "4000\n",
      "4100\n",
      "4200\n",
      "4300\n",
      "4400\n",
      "4500\n",
      "4600\n",
      "4700\n",
      "4800\n",
      "4900\n",
      "5000\n",
      "5100\n",
      "5200\n",
      "5300\n",
      "5400\n",
      "5500\n",
      "5600\n",
      "5700\n",
      "5800\n",
      "5900\n",
      "6000\n",
      "6100\n",
      "6200\n",
      "6300\n",
      "6400\n",
      "6500\n",
      "6600\n",
      "6700\n",
      "6800\n",
      "6900\n",
      "7000\n",
      "7100\n",
      "7200\n",
      "7300\n",
      "7400\n",
      "7500\n",
      "7600\n",
      "7700\n",
      "7800\n",
      "7900\n",
      "8000\n",
      "8100\n",
      "8200\n",
      "8300\n",
      "8400\n",
      "8500\n",
      "8600\n",
      "8700\n",
      "8800\n",
      "8900\n",
      "9000\n",
      "9100\n",
      "9200\n"
      "2020-03-16 12:10:04.720029 0\n",
      "2020-03-16 12:10:08.637949 100\n"
=======
      "2020-03-11 11:36:23.476848 0\n",
      "2020-03-11 11:36:30.331549 100\n",
      "2020-03-11 11:36:34.472693 200\n",
      "2020-03-11 11:36:38.850497 300\n",
      "2020-03-11 11:36:43.064008 400\n",
      "2020-03-11 11:36:47.270678 500\n",
      "2020-03-11 11:36:51.486704 600\n",
      "2020-03-11 11:36:55.706254 700\n",
      "2020-03-11 11:36:59.936205 800\n",
      "2020-03-11 11:37:04.078097 900\n",
      "2020-03-11 11:37:08.383133 1000\n",
      "2020-03-11 11:37:12.736273 1100\n",
      "2020-03-11 11:37:16.938156 1200\n",
      "2020-03-11 11:37:21.251764 1300\n",
      "2020-03-11 11:37:25.346001 1400\n",
      "2020-03-11 11:37:29.404595 1500\n",
      "2020-03-11 11:37:33.494907 1600\n",
      "2020-03-11 11:37:37.565368 1700\n",
      "2020-03-11 11:37:41.892453 1800\n",
      "2020-03-11 11:37:46.083624 1900\n",
      "2020-03-11 11:37:50.419281 2000\n",
      "2020-03-11 11:37:54.779931 2100\n",
      "2020-03-11 11:37:59.020572 2200\n",
      "2020-03-11 11:38:03.267463 2300\n",
      "2020-03-11 11:38:07.539679 2400\n",
      "2020-03-11 11:38:11.785794 2500\n",
      "2020-03-11 11:38:15.988415 2600\n",
      "2020-03-11 11:38:20.182361 2700\n",
      "2020-03-11 11:38:24.412181 2800\n",
      "2020-03-11 11:38:30.061729 2900\n",
      "2020-03-11 11:38:35.497125 3000\n",
      "2020-03-11 11:38:40.200001 3100\n",
      "2020-03-11 11:38:44.456390 3200\n",
      "2020-03-11 11:38:48.724308 3300\n",
      "2020-03-11 11:38:52.956783 3400\n",
      "2020-03-11 11:38:57.195059 3500\n",
      "2020-03-11 11:39:01.464245 3600\n",
      "2020-03-11 11:39:05.673722 3700\n",
      "2020-03-11 11:39:09.912836 3800\n",
      "2020-03-11 11:39:14.281901 3900\n",
      "2020-03-11 11:39:18.561767 4000\n",
      "2020-03-11 11:39:22.931650 4100\n",
      "2020-03-11 11:39:27.993738 4200\n",
      "2020-03-11 11:39:32.121208 4300\n",
      "2020-03-11 11:39:36.183721 4400\n",
      "2020-03-11 11:39:40.820820 4500\n",
      "2020-03-11 11:39:45.239106 4600\n",
      "2020-03-11 11:39:49.649764 4700\n",
      "2020-03-11 11:39:53.917369 4800\n",
      "2020-03-11 11:39:58.266066 4900\n",
      "2020-03-11 11:40:02.491990 5000\n",
      "2020-03-11 11:40:06.953924 5100\n",
      "2020-03-11 11:40:11.638478 5200\n",
      "2020-03-11 11:40:18.414378 5300\n",
      "2020-03-11 11:40:22.905928 5400\n",
      "2020-03-11 11:40:27.140928 5500\n",
      "2020-03-11 11:40:31.364334 5600\n",
      "2020-03-11 11:40:35.563762 5700\n",
      "2020-03-11 11:40:39.735959 5800\n",
      "2020-03-11 11:40:44.020268 5900\n",
      "2020-03-11 11:40:49.084888 6000\n",
      "2020-03-11 11:40:53.319602 6100\n",
      "2020-03-11 11:40:57.673983 6200\n",
      "2020-03-11 11:41:01.831896 6300\n"
>>>>>>> 96b4a10226fe47e8903cc6e716989b8a1a9100d4:Untitled1.ipynb
     ]
    },
    {
     "ename": "KeyboardInterrupt",
     "evalue": "",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mKeyboardInterrupt\u001b[0m                         Traceback (most recent call last)",
<<<<<<< HEAD:Untitled1.ipynb.bk
      "\u001b[0;32m<ipython-input-5-7c51a4052bb4>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[1;32m     26\u001b[0m             \u001b[0mwrite_image\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mcv2\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0maddWeighted\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0msrc1\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mcv2\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcvtColor\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mimage3\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcv2\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mCOLOR_RGB2GRAY\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0malpha\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;36m0.2\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0msrc2\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0moutput_numpy\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mbeta\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;36m0.8\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0mgamma\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;36m0\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mdtype\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mcv2\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mCV_32F\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     27\u001b[0m             \u001b[0;31m#write_image = cv2.bitwise_and(src1=image_numpy, src2=output_numpy)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 28\u001b[0;31m             \u001b[0mcv2\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mimwrite\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m'output/{:05d}.jpg'\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mformat\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mcount\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mwrite_image\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     29\u001b[0m     \u001b[0;32mif\u001b[0m \u001b[0mcount\u001b[0m \u001b[0;34m%\u001b[0m \u001b[0;36m100\u001b[0m \u001b[0;34m==\u001b[0m \u001b[0;36m0\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     30\u001b[0m         \u001b[0mprint\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mdatetime\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdatetime\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mnow\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mcount\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
=======
      "\u001b[0;32m<ipython-input-13-1f94d2cb7e6d>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[1;32m     22\u001b[0m             \u001b[0mimage\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mtorch\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mfrom_numpy\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mimage\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mfloat\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mto\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mcuda0\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     23\u001b[0m             \u001b[0moutput\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mmodel\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mimage\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 24\u001b[0;31m             \u001b[0moutput_numpy\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0moutput\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msqueeze\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcpu\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdetach\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mnumpy\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     25\u001b[0m             \u001b[0;31m#output_numpy = cv2.cvtColor(output_numpy, cv2.COLOR_RGB2GRAY)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     26\u001b[0m             \u001b[0;31m#output_numpy = cv2.cvtColor(output_numpy, cv2.COLOR_GRAY2RGB)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
>>>>>>> 96b4a10226fe47e8903cc6e716989b8a1a9100d4:Untitled1.ipynb
      "\u001b[0;31mKeyboardInterrupt\u001b[0m: "
     ]
    }
   ],
   "source": [
    "cap = cv2.VideoCapture('../data/DJI_0016.MP4')\n",
    "count = -1\n",
    "image1 = image2 = image3 = None\n",
    "while True:\n",
    "    count += 1\n",
    "    ret, frame = cap.read()\n",
    "    if ret:\n",
    "        image = cv2.resize(frame, (640, 360))\n",
    "        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n",
    "        if count == 0:\n",
    "            image1 = image\n",
    "        elif count == 1:\n",
    "            image2 = image\n",
    "        elif count == 2:\n",
    "            image3 = image\n",
    "        else:\n",
    "            image1, image2 = image2, image3\n",
    "            image3 = image\n",
    "            image = np.dstack([image3, image2, image1])\n",
    "            image = image.transpose((2, 0, 1))\n",
    "            image = image[np.newaxis, :]\n",
    "            image = torch.from_numpy(image).float().to(cuda0)\n",
    "            output = model(image)\n",
    "            output_numpy = output.squeeze().cpu().detach().numpy()\n",
    "            \n",
    "            write_image = cv2.addWeighted(src1=cv2.cvtColor(image3, cv2.COLOR_RGB2GRAY),alpha=0.2,src2=output_numpy,beta=0.8,gamma=0, dtype=cv2.CV_32F)\n",
    "            #write_image = cv2.bitwise_and(src1=image_numpy, src2=output_numpy)\n",
    "            cv2.imwrite('output/{:05d}.jpg'.format(count), write_image)\n",
    "    if count % 100 == 0:\n",
    "        print(datetime.datetime.now(), count)"
   ]
  },
  {
   "cell_type": "code",
<<<<<<< HEAD:Untitled1.ipynb.bk
   "execution_count": 15,
=======
   "execution_count": 25,
>>>>>>> 96b4a10226fe47e8903cc6e716989b8a1a9100d4:Untitled1.ipynb
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
<<<<<<< HEAD:Untitled1.ipynb.bk
      "2020-03-16 12:19:28.977621 0\n",
      "2020-03-16 12:19:35.430438 100\n",
      "2020-03-16 12:19:41.850997 200\n",
      "2020-03-16 12:19:48.273604 300\n",
      "2020-03-16 12:19:54.691998 400\n",
      "2020-03-16 12:20:01.111713 500\n",
      "2020-03-16 12:20:08.285177 600\n",
      "2020-03-16 12:20:14.737642 700\n",
      "2020-03-16 12:20:21.183848 800\n",
      "2020-03-16 12:20:27.616309 900\n",
      "2020-03-16 12:20:34.065764 1000\n",
      "2020-03-16 12:20:40.501988 1100\n",
      "2020-03-16 12:20:46.937932 1200\n",
      "2020-03-16 12:20:53.378333 1300\n",
      "2020-03-16 12:20:59.831534 1400\n",
      "2020-03-16 12:21:06.333844 1500\n",
      "2020-03-16 12:21:12.881167 1600\n",
      "2020-03-16 12:21:19.449690 1700\n",
      "2020-03-16 12:21:25.983546 1800\n",
      "2020-03-16 12:21:32.516665 1900\n",
      "2020-03-16 12:21:39.066448 2000\n",
      "2020-03-16 12:21:45.653676 2100\n",
      "2020-03-16 12:21:52.245878 2200\n",
      "2020-03-16 12:21:58.878952 2300\n",
      "2020-03-16 12:22:05.460442 2400\n",
      "2020-03-16 12:22:12.496795 2500\n",
      "2020-03-16 12:22:19.089132 2600\n",
      "2020-03-16 12:22:25.686748 2700\n",
      "2020-03-16 12:22:32.310582 2800\n",
      "2020-03-16 12:22:38.911882 2900\n",
      "2020-03-16 12:22:45.548705 3000\n",
      "2020-03-16 12:22:52.224748 3100\n",
      "2020-03-16 12:22:59.148727 3200\n",
      "2020-03-16 12:23:06.040890 3300\n",
      "2020-03-16 12:23:12.613398 3400\n",
      "2020-03-16 12:23:19.159190 3500\n",
      "2020-03-16 12:23:25.834695 3600\n",
      "2020-03-16 12:23:32.497575 3700\n",
      "2020-03-16 12:23:39.139747 3800\n",
      "2020-03-16 12:23:45.837496 3900\n",
      "2020-03-16 12:23:52.448989 4000\n",
      "2020-03-16 12:23:58.989268 4100\n",
      "2020-03-16 12:24:05.472412 4200\n",
      "2020-03-16 12:24:12.025288 4300\n",
      "2020-03-16 12:24:18.742676 4400\n",
      "2020-03-16 12:24:25.629596 4500\n",
      "2020-03-16 12:24:32.469953 4600\n",
      "2020-03-16 12:24:39.407723 4700\n",
      "2020-03-16 12:24:46.292329 4800\n",
      "2020-03-16 12:24:53.131245 4900\n",
      "2020-03-16 12:25:00.007935 5000\n",
      "2020-03-16 12:25:06.891641 5100\n",
      "2020-03-16 12:25:13.827550 5200\n",
      "2020-03-16 12:25:20.717849 5300\n",
      "2020-03-16 12:25:27.811475 5400\n",
      "2020-03-16 12:25:34.828694 5500\n",
      "2020-03-16 12:25:41.533671 5600\n",
      "2020-03-16 12:25:48.444181 5700\n",
      "2020-03-16 12:25:55.248127 5800\n",
      "2020-03-16 12:26:01.981589 5900\n",
      "2020-03-16 12:26:08.926989 6000\n",
      "2020-03-16 12:26:15.421986 6100\n",
      "2020-03-16 12:26:22.274592 6200\n",
      "2020-03-16 12:26:28.734045 6300\n",
      "2020-03-16 12:26:35.205646 6400\n",
      "2020-03-16 12:26:41.974005 6500\n",
      "2020-03-16 12:26:48.419170 6600\n",
      "2020-03-16 12:26:55.129395 6700\n",
      "2020-03-16 12:27:02.017422 6800\n",
      "2020-03-16 12:27:08.976662 6900\n",
      "2020-03-16 12:27:15.938882 7000\n",
      "2020-03-16 12:27:22.704988 7100\n",
      "2020-03-16 12:27:29.475421 7200\n",
      "2020-03-16 12:27:36.025364 7300\n",
      "2020-03-16 12:27:42.665606 7400\n",
      "2020-03-16 12:27:49.516029 7500\n",
      "2020-03-16 12:27:56.114182 7600\n",
      "2020-03-16 12:28:02.850330 7700\n",
      "2020-03-16 12:28:09.591456 7800\n",
      "2020-03-16 12:28:16.415178 7900\n",
      "2020-03-16 12:28:23.256765 8000\n",
      "2020-03-16 12:28:30.203811 8100\n",
      "2020-03-16 12:28:37.005545 8200\n",
      "2020-03-16 12:28:43.822400 8300\n",
      "2020-03-16 12:28:50.685444 8400\n",
      "2020-03-16 12:28:57.516446 8500\n",
      "2020-03-16 12:29:04.442924 8600\n",
      "2020-03-16 12:29:11.032782 8700\n",
      "2020-03-16 12:29:17.749357 8800\n",
      "2020-03-16 12:29:24.355684 8900\n",
      "2020-03-16 12:29:31.062743 9000\n",
      "2020-03-16 12:29:37.921344 9100\n",
      "2020-03-16 12:29:44.542027 9200\n",
      "2020-03-16 12:29:51.730711 9300\n",
      "2020-03-16 12:29:58.818281 9400\n",
      "2020-03-16 12:30:05.956170 9500\n",
      "2020-03-16 12:30:13.396124 9600\n",
      "2020-03-16 12:30:20.282888 9700\n",
      "2020-03-16 12:30:27.138204 9800\n",
      "2020-03-16 12:30:34.168182 9900\n",
      "2020-03-16 12:30:40.890993 10000\n",
      "2020-03-16 12:30:47.720263 10100\n",
      "2020-03-16 12:30:54.394955 10200\n",
      "2020-03-16 12:31:01.090519 10300\n",
      "2020-03-16 12:31:07.588321 10400\n",
      "2020-03-16 12:31:14.073739 10500\n",
      "2020-03-16 12:31:20.689778 10600\n",
      "2020-03-16 12:31:27.137438 10700\n",
      "2020-03-16 12:31:33.568659 10800\n",
      "2020-03-16 12:31:39.966562 10900\n",
      "2020-03-16 12:31:46.446713 11000\n",
      "2020-03-16 12:31:53.121609 11100\n",
      "2020-03-16 12:31:59.844586 11200\n",
      "2020-03-16 12:32:06.563868 11300\n",
      "2020-03-16 12:32:13.264115 11400\n",
      "2020-03-16 12:32:19.979749 11500\n",
      "2020-03-16 12:32:26.593664 11600\n",
      "2020-03-16 12:32:33.534775 11700\n",
      "2020-03-16 12:32:40.230206 11800\n",
      "2020-03-16 12:32:46.797862 11900\n",
      "2020-03-16 12:32:53.352080 12000\n",
      "2020-03-16 12:32:59.998145 12100\n",
      "2020-03-16 12:33:06.498719 12200\n",
      "2020-03-16 12:33:13.177660 12300\n",
      "2020-03-16 12:33:19.903359 12400\n",
      "2020-03-16 12:33:26.950697 12500\n",
      "2020-03-16 12:33:33.874614 12600\n",
      "2020-03-16 12:33:40.826780 12700\n",
      "2020-03-16 12:33:47.576024 12800\n",
      "2020-03-16 12:33:54.194469 12900\n",
      "2020-03-16 12:34:00.906757 13000\n",
      "2020-03-16 12:34:08.006498 13100\n",
      "2020-03-16 12:34:14.853900 13200\n",
      "2020-03-16 12:34:21.652176 13300\n",
      "2020-03-16 12:34:28.227244 13400\n",
      "2020-03-16 12:34:34.696998 13500\n",
      "2020-03-16 12:34:41.148726 13600\n",
      "2020-03-16 12:34:47.682903 13700\n",
      "2020-03-16 12:34:54.153108 13800\n",
      "2020-03-16 12:35:00.750601 13900\n",
      "2020-03-16 12:35:07.310712 14000\n",
      "2020-03-16 12:35:13.882738 14100\n",
      "2020-03-16 12:35:20.464650 14200\n",
      "2020-03-16 12:35:27.054104 14300\n",
      "2020-03-16 12:35:33.853758 14400\n",
      "2020-03-16 12:35:40.438016 14500\n",
      "2020-03-16 12:35:47.222400 14600\n",
      "2020-03-16 12:35:53.911833 14700\n",
      "2020-03-16 12:36:00.685371 14800\n",
      "2020-03-16 12:36:07.296056 14900\n",
      "2020-03-16 12:36:13.928351 15000\n",
      "2020-03-16 12:36:20.506648 15100\n",
      "2020-03-16 12:36:27.116813 15200\n",
      "2020-03-16 12:36:33.624380 15300\n",
      "2020-03-16 12:36:40.242930 15400\n",
      "2020-03-16 12:36:46.896609 15500\n",
      "2020-03-16 12:36:53.484376 15600\n",
      "2020-03-16 12:37:00.198244 15700\n",
      "2020-03-16 12:37:06.808886 15800\n",
      "2020-03-16 12:37:13.421046 15900\n",
      "2020-03-16 12:37:20.259035 16000\n",
      "2020-03-16 12:37:27.375480 16100\n",
      "2020-03-16 12:37:33.853534 16200\n",
      "2020-03-16 12:37:40.374777 16300\n",
      "2020-03-16 12:37:46.966887 16400\n",
      "2020-03-16 12:37:53.580201 16500\n",
      "2020-03-16 12:38:00.056163 16600\n",
      "2020-03-16 12:38:06.972626 16700\n",
      "2020-03-16 12:38:13.414718 16800\n",
      "2020-03-16 12:38:19.852537 16900\n",
      "2020-03-16 12:38:26.605025 17000\n",
      "2020-03-16 12:38:33.192222 17100\n",
      "2020-03-16 12:38:39.821722 17200\n",
      "2020-03-16 12:38:46.346704 17300\n",
      "2020-03-16 12:38:53.093794 17400\n",
      "2020-03-16 12:38:59.542247 17500\n",
      "2020-03-16 12:39:06.133131 17600\n",
      "2020-03-16 12:39:12.609146 17700\n",
      "2020-03-16 12:39:19.245015 17800\n",
      "2020-03-16 12:39:25.697442 17900\n",
      "2020-03-16 12:39:32.133372 18000\n",
      "2020-03-16 12:39:38.627554 18100\n",
      "2020-03-16 12:39:45.217574 18200\n",
      "2020-03-16 12:39:51.853355 18300\n",
      "2020-03-16 12:39:58.551781 18400\n",
      "2020-03-16 12:40:05.403224 18500\n",
      "2020-03-16 12:40:12.111589 18600\n",
      "2020-03-16 12:40:18.850082 18700\n",
      "2020-03-16 12:40:25.594482 18800\n",
      "2020-03-16 12:40:32.327162 18900\n",
      "2020-03-16 12:40:39.072175 19000\n",
      "2020-03-16 12:40:45.795427 19100\n",
      "2020-03-16 12:40:52.670391 19200\n",
      "2020-03-16 12:40:59.346542 19300\n",
      "2020-03-16 12:41:05.958948 19400\n",
      "2020-03-16 12:41:12.565385 19500\n",
      "2020-03-16 12:41:19.322616 19600\n",
      "2020-03-16 12:41:25.838478 19700\n",
      "2020-03-16 12:41:32.486956 19800\n",
      "2020-03-16 12:41:39.142318 19900\n",
      "2020-03-16 12:41:45.648682 20000\n",
      "2020-03-16 12:41:52.297014 20100\n",
      "2020-03-16 12:41:58.874977 20200\n",
      "2020-03-16 12:42:05.476349 20300\n",
      "2020-03-16 12:42:11.967957 20400\n",
      "2020-03-16 12:42:18.635783 20500\n",
      "2020-03-16 12:42:25.097619 20600\n",
      "2020-03-16 12:42:31.915146 20700\n",
      "2020-03-16 12:42:38.471457 20800\n",
      "2020-03-16 12:42:45.155295 20900\n",
      "2020-03-16 12:42:51.867629 21000\n",
      "2020-03-16 12:42:58.414841 21100\n",
      "2020-03-16 12:43:04.890073 21200\n",
      "2020-03-16 12:43:11.332027 21300\n",
      "2020-03-16 12:43:17.796847 21400\n",
      "2020-03-16 12:43:24.302401 21500\n",
      "2020-03-16 12:43:30.820512 21600\n",
      "2020-03-16 12:43:37.390323 21700\n",
      "2020-03-16 12:43:44.026678 21800\n",
      "2020-03-16 12:43:50.790246 21900\n",
      "2020-03-16 12:43:57.506847 22000\n",
      "2020-03-16 12:44:04.068327 22100\n",
      "2020-03-16 12:44:10.914664 22200\n",
      "2020-03-16 12:44:17.548745 22300\n",
      "2020-03-16 12:44:24.149370 22400\n",
      "2020-03-16 12:44:30.948402 22500\n",
      "2020-03-16 12:44:37.535909 22600\n",
      "2020-03-16 12:44:44.164169 22700\n",
      "2020-03-16 12:44:50.884348 22800\n",
      "2020-03-16 12:44:57.543724 22900\n",
      "2020-03-16 12:45:04.216675 23000\n",
      "2020-03-16 12:45:10.810381 23100\n",
      "2020-03-16 12:45:17.449779 23200\n",
      "2020-03-16 12:45:24.261356 23300\n",
      "2020-03-16 12:45:30.909480 23400\n",
      "2020-03-16 12:45:37.388520 23500\n",
      "2020-03-16 12:45:44.029508 23600\n",
      "2020-03-16 12:45:50.472465 23700\n",
      "2020-03-16 12:45:56.962772 23800\n",
      "2020-03-16 12:46:03.436829 23900\n",
      "2020-03-16 12:46:09.986002 24000\n",
      "2020-03-16 12:46:16.444310 24100\n",
      "2020-03-16 12:46:22.901137 24200\n",
      "2020-03-16 12:46:29.400814 24300\n",
      "2020-03-16 12:46:36.094106 24400\n",
      "2020-03-16 12:46:42.775945 24500\n",
      "2020-03-16 12:46:49.372607 24600\n",
      "2020-03-16 12:46:55.978566 24700\n",
      "2020-03-16 12:47:02.716728 24800\n",
      "2020-03-16 12:47:09.281943 24900\n",
      "2020-03-16 12:47:16.055449 25000\n",
      "2020-03-16 12:47:22.574547 25100\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "2020-03-16 12:47:29.135504 25200\n",
      "2020-03-16 12:47:35.759240 25300\n",
      "2020-03-16 12:47:42.420195 25400\n",
      "2020-03-16 12:47:48.967614 25500\n",
      "2020-03-16 12:47:55.558181 25600\n",
      "2020-03-16 12:48:02.155314 25700\n",
      "2020-03-16 12:48:08.752775 25800\n",
      "2020-03-16 12:48:15.377220 25900\n",
      "2020-03-16 12:48:22.149531 26000\n",
      "2020-03-16 12:48:28.993892 26100\n",
      "2020-03-16 12:48:35.610906 26200\n",
      "2020-03-16 12:48:42.415308 26300\n",
      "2020-03-16 12:48:49.054190 26400\n",
      "2020-03-16 12:48:55.900397 26500\n",
      "2020-03-16 12:49:02.572833 26600\n",
      "2020-03-16 12:49:09.272543 26700\n",
      "2020-03-16 12:49:15.943191 26800\n",
      "2020-03-16 12:49:22.618284 26900\n",
      "2020-03-16 12:49:29.217908 27000\n",
      "2020-03-16 12:49:36.295589 27100\n",
      "2020-03-16 12:49:43.060425 27200\n",
      "2020-03-16 12:49:49.676365 27300\n",
      "2020-03-16 12:49:56.264044 27400\n",
      "2020-03-16 12:50:02.865197 27500\n",
      "2020-03-16 12:50:09.348229 27600\n",
      "2020-03-16 12:50:15.981265 27700\n",
      "2020-03-16 12:50:22.716348 27800\n",
      "2020-03-16 12:50:29.301420 27900\n",
      "2020-03-16 12:50:35.888930 28000\n",
      "2020-03-16 12:50:42.790154 28100\n",
      "2020-03-16 12:50:49.422588 28200\n",
      "2020-03-16 12:50:55.918395 28300\n",
      "2020-03-16 12:51:02.414910 28400\n",
      "2020-03-16 12:51:08.972236 28500\n",
      "2020-03-16 12:51:15.420510 28600\n",
      "2020-03-16 12:51:22.077279 28700\n",
      "2020-03-16 12:51:28.716298 28800\n",
      "2020-03-16 12:51:35.272185 28900\n",
      "2020-03-16 12:51:41.849300 29000\n",
      "2020-03-16 12:51:48.422611 29100\n",
      "2020-03-16 12:51:55.065919 29200\n",
      "2020-03-16 12:52:01.634259 29300\n",
      "2020-03-16 12:52:08.180768 29400\n",
      "2020-03-16 12:52:14.822723 29500\n",
      "2020-03-16 12:52:21.412739 29600\n",
      "2020-03-16 12:52:28.316258 29700\n",
      "2020-03-16 12:52:35.229585 29800\n",
      "2020-03-16 12:52:41.722327 29900\n",
      "2020-03-16 12:52:48.217196 30000\n",
      "2020-03-16 12:52:54.852786 30100\n",
      "2020-03-16 12:53:01.692819 30200\n",
      "2020-03-16 12:53:08.453223 30300\n",
      "2020-03-16 12:53:15.044729 30400\n",
      "2020-03-16 12:53:21.642707 30500\n",
      "2020-03-16 12:53:28.526175 30600\n",
      "2020-03-16 12:53:35.472454 30700\n",
      "2020-03-16 12:53:42.184651 30800\n",
      "2020-03-16 12:53:48.829602 30900\n",
      "2020-03-16 12:53:55.561976 31000\n",
      "2020-03-16 12:54:02.411397 31100\n",
      "2020-03-16 12:54:09.244172 31200\n",
      "2020-03-16 12:54:16.005883 31300\n",
      "2020-03-16 12:54:22.569831 31400\n",
      "2020-03-16 12:54:29.126392 31500\n",
      "2020-03-16 12:54:35.700858 31600\n",
      "2020-03-16 12:54:42.414358 31700\n",
      "2020-03-16 12:54:49.151738 31800\n",
      "2020-03-16 12:54:55.721335 31900\n",
      "2020-03-16 12:55:02.316518 32000\n",
      "2020-03-16 12:55:08.816100 32100\n",
      "2020-03-16 12:55:15.302711 32200\n",
      "2020-03-16 12:55:21.813560 32300\n",
      "2020-03-16 12:55:28.550099 32400\n",
      "2020-03-16 12:55:35.112608 32500\n"
=======
      "2020-03-11 12:02:48.174748 0\n",
      "2020-03-11 12:02:52.330906 100\n",
      "2020-03-11 12:02:56.507909 200\n",
      "2020-03-11 12:03:00.661521 300\n",
      "2020-03-11 12:03:04.798286 400\n",
      "2020-03-11 12:03:08.959563 500\n",
      "2020-03-11 12:03:13.132173 600\n",
      "2020-03-11 12:03:17.291168 700\n",
      "2020-03-11 12:03:21.459125 800\n",
      "2020-03-11 12:03:25.641072 900\n",
      "2020-03-11 12:03:29.805572 1000\n",
      "2020-03-11 12:03:34.012418 1100\n",
      "2020-03-11 12:03:38.191359 1200\n",
      "2020-03-11 12:03:42.388909 1300\n",
      "2020-03-11 12:03:46.581216 1400\n",
      "2020-03-11 12:03:50.777818 1500\n",
      "2020-03-11 12:03:54.969341 1600\n",
      "2020-03-11 12:03:59.171175 1700\n",
      "2020-03-11 12:04:03.355751 1800\n",
      "2020-03-11 12:04:07.515249 1900\n",
      "2020-03-11 12:04:11.665637 2000\n",
      "2020-03-11 12:04:15.851444 2100\n",
      "2020-03-11 12:04:20.005709 2200\n",
      "2020-03-11 12:04:24.162145 2300\n",
      "2020-03-11 12:04:28.323429 2400\n",
      "2020-03-11 12:04:32.507151 2500\n",
      "2020-03-11 12:04:36.661135 2600\n",
      "2020-03-11 12:04:40.829946 2700\n",
      "2020-03-11 12:04:45.027776 2800\n",
      "2020-03-11 12:04:49.236341 2900\n",
      "2020-03-11 12:04:53.484528 3000\n",
      "2020-03-11 12:04:57.654911 3100\n",
      "2020-03-11 12:05:01.850185 3200\n",
      "2020-03-11 12:05:06.038772 3300\n",
      "2020-03-11 12:05:10.233217 3400\n",
      "2020-03-11 12:05:14.438372 3500\n",
      "2020-03-11 12:05:18.640578 3600\n",
      "2020-03-11 12:05:22.831509 3700\n",
      "2020-03-11 12:05:27.026603 3800\n",
      "2020-03-11 12:05:31.212709 3900\n",
      "2020-03-11 12:05:35.424833 4000\n",
      "2020-03-11 12:05:39.647009 4100\n",
      "2020-03-11 12:05:43.855260 4200\n",
      "2020-03-11 12:05:48.065221 4300\n",
      "2020-03-11 12:05:52.281960 4400\n",
      "2020-03-11 12:05:56.483144 4500\n",
      "2020-03-11 12:06:00.900208 4600\n",
      "2020-03-11 12:06:05.088140 4700\n",
      "2020-03-11 12:06:09.248730 4800\n",
      "2020-03-11 12:06:13.425233 4900\n",
      "2020-03-11 12:06:17.567138 5000\n",
      "2020-03-11 12:06:21.708149 5100\n",
      "2020-03-11 12:06:25.868724 5200\n",
      "2020-03-11 12:06:30.040203 5300\n",
      "2020-03-11 12:06:34.206521 5400\n",
      "2020-03-11 12:06:38.383203 5500\n",
      "2020-03-11 12:06:42.544473 5600\n",
      "2020-03-11 12:06:46.721804 5700\n",
      "2020-03-11 12:06:50.914415 5800\n",
      "2020-03-11 12:06:55.092017 5900\n",
      "2020-03-11 12:06:59.285889 6000\n",
      "2020-03-11 12:07:03.479179 6100\n",
      "2020-03-11 12:07:07.680253 6200\n",
      "2020-03-11 12:07:11.886984 6300\n",
      "2020-03-11 12:07:16.102993 6400\n",
      "2020-03-11 12:07:20.319761 6500\n",
      "2020-03-11 12:07:24.509271 6600\n",
      "2020-03-11 12:07:28.702642 6700\n",
      "2020-03-11 12:07:32.900658 6800\n",
      "2020-03-11 12:07:37.075149 6900\n",
      "2020-03-11 12:07:41.246685 7000\n",
      "2020-03-11 12:07:45.462334 7100\n",
      "2020-03-11 12:07:49.646550 7200\n",
      "2020-03-11 12:07:53.855687 7300\n",
      "2020-03-11 12:07:58.069220 7400\n",
      "2020-03-11 12:08:02.273963 7500\n",
      "2020-03-11 12:08:06.466083 7600\n",
      "2020-03-11 12:08:10.661229 7700\n",
      "2020-03-11 12:08:14.835067 7800\n",
      "2020-03-11 12:08:18.994228 7900\n",
      "2020-03-11 12:08:23.152404 8000\n",
      "2020-03-11 12:08:27.355210 8100\n",
      "2020-03-11 12:08:31.500062 8200\n",
      "2020-03-11 12:08:35.650434 8300\n",
      "2020-03-11 12:08:39.790652 8400\n",
      "2020-03-11 12:08:43.959278 8500\n",
      "2020-03-11 12:08:48.158944 8600\n",
      "2020-03-11 12:08:52.341684 8700\n",
      "2020-03-11 12:08:56.505259 8800\n",
      "2020-03-11 12:09:00.656989 8900\n",
      "2020-03-11 12:09:04.830843 9000\n",
      "2020-03-11 12:09:09.022365 9100\n",
      "2020-03-11 12:09:13.209289 9200\n",
      "2020-03-11 12:09:17.410660 9300\n",
      "2020-03-11 12:09:21.614636 9400\n",
      "2020-03-11 12:09:25.812795 9500\n",
      "2020-03-11 12:09:30.427471 9600\n",
      "2020-03-11 12:09:34.700145 9700\n",
      "2020-03-11 12:09:38.977635 9800\n",
      "2020-03-11 12:09:43.279526 9900\n",
      "2020-03-11 12:09:47.527461 10000\n",
      "2020-03-11 12:09:51.992048 10100\n",
      "2020-03-11 12:09:56.227733 10200\n",
      "2020-03-11 12:10:00.458276 10300\n",
      "2020-03-11 12:10:04.895250 10400\n",
      "2020-03-11 12:10:09.146389 10500\n",
      "2020-03-11 12:10:13.403064 10600\n",
      "2020-03-11 12:10:17.694919 10700\n",
      "2020-03-11 12:10:21.939174 10800\n",
      "2020-03-11 12:10:26.209370 10900\n",
      "2020-03-11 12:10:30.468320 11000\n",
      "2020-03-11 12:10:34.750541 11100\n",
      "2020-03-11 12:10:39.260925 11200\n",
      "2020-03-11 12:10:43.577089 11300\n",
      "2020-03-11 12:10:48.052304 11400\n",
      "2020-03-11 12:10:52.385980 11500\n",
      "2020-03-11 12:10:56.916490 11600\n",
      "2020-03-11 12:11:01.181155 11700\n",
      "2020-03-11 12:11:05.408876 11800\n",
      "2020-03-11 12:11:09.727672 11900\n",
      "2020-03-11 12:11:14.312468 12000\n",
      "2020-03-11 12:11:19.179800 12100\n",
      "2020-03-11 12:11:23.542593 12200\n",
      "2020-03-11 12:11:29.009853 12300\n",
      "2020-03-11 12:11:33.302117 12400\n",
      "2020-03-11 12:11:37.584683 12500\n",
      "2020-03-11 12:11:41.864654 12600\n",
      "2020-03-11 12:11:46.095653 12700\n",
      "2020-03-11 12:11:50.495211 12800\n",
      "2020-03-11 12:11:56.587334 12900\n",
      "2020-03-11 12:12:00.817542 13000\n",
      "2020-03-11 12:12:05.069011 13100\n",
      "2020-03-11 12:12:09.358550 13200\n",
      "2020-03-11 12:12:13.612976 13300\n",
      "2020-03-11 12:12:17.927893 13400\n",
      "2020-03-11 12:12:22.304368 13500\n",
      "2020-03-11 12:12:27.242037 13600\n",
      "2020-03-11 12:12:31.481720 13700\n",
      "2020-03-11 12:12:35.729027 13800\n",
      "2020-03-11 12:12:39.972589 13900\n",
      "2020-03-11 12:12:44.292965 14000\n",
      "2020-03-11 12:12:48.556091 14100\n",
      "2020-03-11 12:12:52.834406 14200\n",
      "2020-03-11 12:12:57.122391 14300\n",
      "2020-03-11 12:13:01.410135 14400\n",
      "2020-03-11 12:13:06.002774 14500\n",
      "2020-03-11 12:13:10.252105 14600\n",
      "2020-03-11 12:13:14.608917 14700\n",
      "2020-03-11 12:13:18.921306 14800\n",
      "2020-03-11 12:13:23.287916 14900\n",
      "2020-03-11 12:13:27.608011 15000\n",
      "2020-03-11 12:13:31.880747 15100\n",
      "2020-03-11 12:13:37.719232 15200\n",
      "2020-03-11 12:13:42.923489 15300\n",
      "2020-03-11 12:13:47.324328 15400\n",
      "2020-03-11 12:13:51.555214 15500\n",
      "2020-03-11 12:13:55.863072 15600\n",
      "2020-03-11 12:14:00.203301 15700\n",
      "2020-03-11 12:14:04.448101 15800\n",
      "2020-03-11 12:14:08.689188 15900\n",
      "2020-03-11 12:14:13.347938 16000\n",
      "2020-03-11 12:14:17.568763 16100\n",
      "2020-03-11 12:14:21.794356 16200\n",
      "2020-03-11 12:14:26.153065 16300\n",
      "2020-03-11 12:14:30.419705 16400\n",
      "2020-03-11 12:14:34.712356 16500\n",
      "2020-03-11 12:14:39.062748 16600\n",
      "2020-03-11 12:14:43.495309 16700\n",
      "2020-03-11 12:14:47.768385 16800\n",
      "2020-03-11 12:14:52.003737 16900\n",
      "2020-03-11 12:14:56.329626 17000\n",
      "2020-03-11 12:15:00.603017 17100\n",
      "2020-03-11 12:15:04.939677 17200\n",
      "2020-03-11 12:15:09.296495 17300\n",
      "2020-03-11 12:15:13.623923 17400\n",
      "2020-03-11 12:15:17.928897 17500\n",
      "2020-03-11 12:15:23.499622 17600\n",
      "2020-03-11 12:15:31.607148 17700\n",
      "2020-03-11 12:15:36.094873 17800\n",
      "2020-03-11 12:15:40.323829 17900\n",
      "2020-03-11 12:15:44.580618 18000\n",
      "2020-03-11 12:15:48.805886 18100\n",
      "2020-03-11 12:15:53.059126 18200\n",
      "2020-03-11 12:15:57.585509 18300\n",
      "2020-03-11 12:16:01.870071 18400\n",
      "2020-03-11 12:16:06.134991 18500\n",
      "2020-03-11 12:16:10.368269 18600\n",
      "2020-03-11 12:16:14.681820 18700\n",
      "2020-03-11 12:16:19.038808 18800\n",
      "2020-03-11 12:16:23.315748 18900\n",
      "2020-03-11 12:16:27.608257 19000\n",
      "2020-03-11 12:16:32.140409 19100\n",
      "2020-03-11 12:16:36.539488 19200\n",
      "2020-03-11 12:16:40.808273 19300\n",
      "2020-03-11 12:16:45.099518 19400\n",
      "2020-03-11 12:16:49.546729 19500\n",
      "2020-03-11 12:16:53.812303 19600\n",
      "2020-03-11 12:16:58.162007 19700\n",
      "2020-03-11 12:17:02.443886 19800\n",
      "2020-03-11 12:17:06.823764 19900\n",
      "2020-03-11 12:17:11.331189 20000\n",
      "2020-03-11 12:17:15.614222 20100\n",
      "2020-03-11 12:17:19.967162 20200\n",
      "2020-03-11 12:17:24.311784 20300\n",
      "2020-03-11 12:17:28.665342 20400\n",
      "2020-03-11 12:17:33.019392 20500\n",
      "2020-03-11 12:17:37.554866 20600\n"
>>>>>>> 96b4a10226fe47e8903cc6e716989b8a1a9100d4:Untitled1.ipynb
     ]
    },
    {
     "ename": "KeyboardInterrupt",
     "evalue": "",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mKeyboardInterrupt\u001b[0m                         Traceback (most recent call last)",
<<<<<<< HEAD:Untitled1.ipynb.bk
      "\u001b[0;32m<ipython-input-15-c9a398f2d90d>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[1;32m     32\u001b[0m             \u001b[0mimage\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mtorch\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mfrom_numpy\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mimage\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mfloat\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mto\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mcuda0\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     33\u001b[0m             \u001b[0moutput\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mmodel\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mimage\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 34\u001b[0;31m             \u001b[0moutput_numpy\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0moutput\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msqueeze\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcpu\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdetach\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mnumpy\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     35\u001b[0m             \u001b[0mmax_y\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mmax_x\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mdetect\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0moutput_numpy\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     36\u001b[0m             \u001b[0mmax_y\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mmax_x\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mmax_y\u001b[0m \u001b[0;34m*\u001b[0m \u001b[0;36m1080\u001b[0m \u001b[0;34m//\u001b[0m \u001b[0;36m360\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mmax_x\u001b[0m \u001b[0;34m*\u001b[0m \u001b[0;36m1920\u001b[0m \u001b[0;34m//\u001b[0m \u001b[0;36m640\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
=======
      "\u001b[0;32m<ipython-input-25-6b57571013d8>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[1;32m     32\u001b[0m             \u001b[0mimage\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mtorch\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mfrom_numpy\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mimage\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mfloat\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mto\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mcuda0\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     33\u001b[0m             \u001b[0moutput\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mmodel\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mimage\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m---> 34\u001b[0;31m             \u001b[0moutput_numpy\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0moutput\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msqueeze\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcpu\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdetach\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mnumpy\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     35\u001b[0m             \u001b[0mmax_y\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mmax_x\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mdetect\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0moutput_numpy\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     36\u001b[0m             \u001b[0mball_list\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mappend\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mmax_x\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mmax_y\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n",
>>>>>>> 96b4a10226fe47e8903cc6e716989b8a1a9100d4:Untitled1.ipynb
      "\u001b[0;31mKeyboardInterrupt\u001b[0m: "
     ]
    }
   ],
   "source": [
    "def displayCircle(image, ballList, thickness=10, radius=25, color=(0, 0, 255)):\n",
    "    for i in range(len(ballList)):\n",
    "        x = int(ballList[i][0])\n",
    "        y = int(ballList[i][1])\n",
    "        if x == y == 0:\n",
    "            continue\n",
    "        cv2.circle(image, (x, y), radius, color, thickness)\n",
    "    return image\n",
    "\n",
<<<<<<< HEAD:Untitled1.ipynb.bk
    "cap = cv2.VideoCapture('../data/DJI_0013.MP4')\n",
    "count = -1\n",
    "image1 = image2 = image3 = None\n",
    "ball_list = []\n",
    "all_ball_list = []\n",
=======
    "cap = cv2.VideoCapture('../data/DJI_0016.MP4')\n",
    "count = -1\n",
    "image1 = image2 = image3 = None\n",
    "ball_list = []\n",
>>>>>>> 96b4a10226fe47e8903cc6e716989b8a1a9100d4:Untitled1.ipynb
    "while True:\n",
    "    count += 1\n",
    "    ret, frame = cap.read()\n",
    "    if ret:\n",
<<<<<<< HEAD:Untitled1.ipynb.bk
    "        image = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)\n",
=======
    "        image = cv2.resize(frame, (640, 360))\n",
    "        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)\n",
>>>>>>> 96b4a10226fe47e8903cc6e716989b8a1a9100d4:Untitled1.ipynb
    "        if count == 0:\n",
    "            image1 = image\n",
    "        elif count == 1:\n",
    "            image2 = image\n",
    "        elif count == 2:\n",
    "            image3 = image\n",
    "        else:\n",
    "            image1, image2 = image2, image3\n",
    "            image3 = image\n",
<<<<<<< HEAD:Untitled1.ipynb.bk
    "            image = np.dstack([cv2.resize(image3, (640, 360)), cv2.resize(image2, (640, 360)), cv2.resize(image1, (640, 360))])\n",
=======
    "            image = np.dstack([image3, image2, image1])\n",
>>>>>>> 96b4a10226fe47e8903cc6e716989b8a1a9100d4:Untitled1.ipynb
    "            image = image.transpose((2, 0, 1))\n",
    "            image = image[np.newaxis, :]\n",
    "            image = torch.from_numpy(image).float().to(cuda0)\n",
    "            output = model(image)\n",
    "            output_numpy = output.squeeze().cpu().detach().numpy()\n",
    "            max_y, max_x = detect(output_numpy)\n",
<<<<<<< HEAD:Untitled1.ipynb.bk
    "            max_y, max_x = max_y * 1080 // 360, max_x * 1920 // 640\n",
    "            ball_list.append((max_x, max_y))\n",
    "            #all_ball_list.append((max_x, max_y))\n",
    "            if len(ball_list) > 200:\n",
    "                ball_list = ball_list[1:]\n",
    "            write_image = displayCircle(cv2.cvtColor(image2, cv2.COLOR_RGB2BGR), ball_list, 5, 5, (0,120,243))\n",
    "            #write_image = cv2.addWeighted(src1=cv2.cvtColor(image2, cv2.COLOR_RGB2GRAY),alpha=0.2,src2=output_numpy,beta=0.8,gamma=0, dtype=cv2.CV_32F)\n",
    "            cv2.imwrite('output/{:05d}.jpg'.format(count), write_image)\n",
    "            \n",
>>>>>>> Stashed changes
=======
    "            ball_list.append((max_x, max_y))\n",
    "            if len(ball_list) > 200:\n",
    "                ball_list = ball_list[1:]\n",
    "            write_image = displayCircle(cv2.cvtColor(image2, cv2.COLOR_RGB2BGR), ball_list, 3, 1, (0,120,243))\n",
    "            #write_image = cv2.addWeighted(src1=cv2.cvtColor(image2, cv2.COLOR_RGB2GRAY),alpha=0.2,src2=output_numpy,beta=0.8,gamma=0, dtype=cv2.CV_32F)\n",
    "            cv2.imwrite('output/{:05d}.jpg'.format(count), write_image)\n",
>>>>>>> 96b4a10226fe47e8903cc6e716989b8a1a9100d4:Untitled1.ipynb
    "    if count % 100 == 0:\n",
    "        print(datetime.datetime.now(), count)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
